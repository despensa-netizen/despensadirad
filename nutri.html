<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Nutricionista — EstoqueSync</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; background: #f8fbff; margin: 0; }
    header { background: #2f75b5; color: white; padding: 15px; display: flex; justify-content: space-between; }
    .container { max-width: 800px; margin: 20px auto; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .hidden { display: none; }
    .btn { background: #2f75b5; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
    input, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
  </style>
</head>
<body>
  <header>
    <h2><i class="fas fa-apple-whole"></i> Painel Nutricional</h2>
    <button onclick="auth.signOut()" class="btn" style="background:rgba(0,0,0,0.2)">Sair</button>
  </header>

  <div class="container hidden" id="mainContent">
    <h3>Planejamento de Cardápio</h3>
    <p>Selecione o dia e a receita planejada:</p>
    <select id="menuDay">
      <option value="Segunda">Segunda-feira</option>
      <option value="Terça">Terça-feira</option>
      <option value="Quarta">Quarta-feira</option>
      <option value="Quinta">Quinta-feira</option>
      <option value="Sexta">Sexta-feira</option>
    </select>
    <input type="text" id="recipeName" placeholder="Nome da Receita">
    <button class="btn" onclick="salvarCardapio()">Salvar no Mural</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCw9_UbayZEcIZOu65yoOSGbHAlomxs-GE",
      authDomain: "estoquesync-f0d10.firebaseapp.com",
      projectId: "estoquesync-f0d10",
      storageBucket: "estoquesync-f0d10.appspot.com",
      messagingSenderId: "67257178512",
      appId: "1:67257178512:web:cdf3f994c0bc87c73ffb15"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    auth.onAuthStateChanged(async (user) => {
      if (!user) { window.location.href = 'index.html'; return; }
      const doc = await db.collection('usuarios').doc(user.uid).get();
      if (!doc.exists || (doc.data().role !== 'nutricionista' && doc.data().role !== 'admin')) {
        alert("Acesso restrito à Nutricionista.");
        auth.signOut();
        return;
      }
      document.getElementById('mainContent').classList.remove('hidden');
    });

    async function salvarCardapio() {
        const dia = document.getElementById('menuDay').value;
        const nome = document.getElementById('recipeName').value;
        if(!nome) return;
        await db.collection('cardapio').doc(dia).set({ dia, nome, data: new Date() });
        alert("Cardápio de " + dia + " atualizado!");
    }
  </script>
</body>
</html>